!function(t,e,i){t.ui=e.extend(t.ui,{fillTemplate:function(e,n){return i(t.ui.formatString(i(e).html(),n).replace(/(<img(\s+.*)?)(\s+jt-src=")/,'$1 src="')).removeAttr("id")},updateCounter:function(t,e,i){var n=null,s="";return null==e&&(e=0),null==i?(n=/\(([\d\?]+)\)$/,s=""+e):(n=/\(([\d\?]+\/[\d\?\+-]+)\)$/,s=""+e+"/"+i),t.match(n)?t=t.replace(n,"("+s+")"):t+=" ("+s+")",t}}),t.ListWidget=function(t){e.extend(!0,this,e.common(t,this)),this.target=t.target,this.length=0,this.clearItems()},t.ListWidget.prototype={itemId:"id",populate:function(t,e){this.items=t,this.length=t.length,i(this.target).empty();for(var n=0,s=t.length;n<s;n++)i(this.target).append(this.renderItem("function"==typeof e?e(t[n]):t[n]))},addItem:function(t){return this.items.push(t),++this.length,this.renderItem(t)},clearItems:function(){i(this.target).empty(),this.items=[],this.length=0},findItem:function(t){var i=this;return e.findIndex(this.items,"string"!=typeof t?t:function(e){return e[i.itemId]===t})},eraseItem:function(t){var e=this.findItem(t),i=e>=0&&this.items.splice(e,1)[0];return this.length=this.items.length,i},enumerateItems:function(t){for(var e=i(this.target).children(),n=0,s=this.items.length;n<s;++n)t.call(e[n],this.items[n])}},t.TagWidget=function(t){e.extend(!0,this,e.common(t,this)),this.nesting&&(this.facet.domain=e.extend(this.facet.domain,{blockChildren:this.nesting})),this.target=i(t.target),this.header=i(t.header),this.id=t.id,this.color=this.color||this.target.data("color")},t.TagWidget.prototype={__expects:["hasValue","clickHandler","getFacetCounts"],color:null,renderTag:null,nesting:null,init:function(i){e.pass(this,t.TagWidget,"init",i),this.manager=i},afterTranslation:function(i){e.pass(this,t.TagWidget,"afterTranslation");var n,s,a=this,r=this.getFacetCounts(i.facets),h=null,l=0,o=getHeaderText(this.header),d=this.header.data("refreshPanel");if(r.sort(function(t,e){return t.val<e.val?-1:1}),0==r.length)this.target.html("No items found in current selection");else{this.target.empty();for(var u=0,c=r.length;u<c;u++)h=r[u],s=this.hasValue(h.val),l+=h.count,h.title=h.val.toString(),"function"==typeof this.modifyTag&&(h=this.modifyTag(h)),s||(h.onMain=a.clickHandler(h.val)),this.target.append(n=this.renderTag(h)),s&&n.addClass("selected")}o.textContent=t.ui.updateCounter(o.textContent,l),d&&d.call()}}}(jToxKit,asSys,jQuery);
