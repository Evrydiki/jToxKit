!function(e,t,a,i){CurrentSearchWidgeting=function(e){t.extend(!0,this,t.common(e,this)),this.target=e.target,this.id=e.id,this.manager=null,this.facetWidgets={},this.fqName=this.useJson?"json.filter":"fq"},CurrentSearchWidgeting.prototype={useJson:!1,renderItem:null,init:function(e){t.pass(this,CurrentSearchWidgeting,"init",e),this.manager=e},registerWidget:function(e,t){this.facetWidgets[e.id]=t},afterTranslation:function(e){var t=this,a=[],i=this.manager.getParameter("q"),n=this.manager.getAllValues(this.fqName);i.value&&!i.value.match(/^(\*:)?\*$/)&&a.push(t.renderItem({title:i.value,count:"x",onMain:function(){return i.value="",t.manager.doRequest(),!1}}).addClass("tag_fixed"));for(var s=0,r=null!=n?n.length:0;s<r;s++){var o=n[s],l=null;for(var d in t.facetWidgets){var u=t.manager.getListener(d);if(l=u.fqParse(o))break}if(null!=l){Array.isArray(l)||(l=[l]);for(var c=0,p=l.length;c<p;++c){var h,g=l[c],m="function"==typeof u.prepareTag?u.prepareTag(g):{title:g,count:"x",color:u.color,onMain:u.unclickHandler(g)};a.push(h=t.renderItem(m).addClass("tag_selected "+(m.onAux?"tag_open":"tag_fixed"))),p>1&&h.addClass("tag_combined")}p>1&&h.addClass("tag_last")}}a.length?(a.push(t.renderItem({title:"Clear",onMain:function(){i.value="";for(var e in t.facetWidgets)t.manager.getListener(e).clearValues();return t.manager.doRequest(),!1}}).addClass("tag_selected tag_clear tag_fixed")),this.target.empty().addClass("tags").append(a)):this.target.removeClass("tags").html("<li>No filters selected!</li>")}},i.CurrentSearchWidget=t(CurrentSearchWidgeting)}(Solr,asSys,jQuery,jToxKit),function(e,t,a,i){var n={},s={servlet:"autophrase",multipleSelection:!0,keepAllFacets:!0,connector:a,onPrepare:function(e){var t=e.url.indexOf("?");this.proxyUrl?(e.data={query:e.url.substr(t+1)},e.url=this.proxyUrl,e.type=e.method="POST"):e.url+=(t<0?"?":"&")+"wt=json"},topSpacing:10,nestingField:"type_s",nestingRules:{composition:{parent:"substance",limit:100},study:{parent:"substance",limit:1e4},params:{parent:"study",limit:1e4},conditions:{parent:"study",limit:1e4}},exportMaxRows:999999,exportTypes:[],exportLevels:{},exportSolrDefaults:["facet=false","echoParams=none"],listingFields:[],facets:[],summaryRenderers:{}},r=function(e){var t,i=t=e.title.replace(/^\"(.+)\"$/,"$1");i=t.replace(/^caNanoLab\./,"").replace(/^http\:\/\/dx\.doi\.org/,""),i=(n[i]||i).replace("NPO_","").replace(" nanoparticle","");var s=a("<span/>").html(e.count||0);"function"==typeof e.onAux&&s.click(e.onAux);var r=a("<li/>").append(a('<a href="#" class="tag" title="'+t+" "+(e.hint||"")+(i!=t?" ["+t+"]":"")+'">'+i+"</a>").append(s));return"function"==typeof e.onMain&&r.click(e.onMain),e.color&&r.addClass(e.color),r},o=function(e){i.TagWidget.prototype.init.call(this,e),e.getListener("current").registerWidget(this)},l=function(e){var a=this.getHeaderText();a.textContent=i.ui.updateCounter(a.textContent,e),t.act(this,this.header.data("refreshPanel"))};i.FacetedSearch=function(e){this.id=null,t.extend(!0,this,s,e),"string"==typeof this.lookupMap&&(this.lookupMap=window[this.lookupMap]),null==this.lookupMap&&(this.lookupMap={}),n=this.lookupMap,a(e.target).html(i.ui.templates["faceted-search-kit"]),delete this.target,this.initDom(),this.initComm(),this.initExport()},i.FacetedSearch.prototype={initDom:function(){this.accordion=a("#accordion"),this.accordion.accordion({heightStyle:"content",collapsible:!0,animate:200,active:!1,activate:function(e,t){if(t.newPanel&&t.newPanel[0]){var i,n=t.newHeader[0],s=t.newPanel[0],r=a("input.widget-filter",s),o=r.outerHeight(!0);a("span.ui-icon-search",n).length?i=t.newPanel.data("refreshPanel"):(i=function(){s.scrollHeight>s.clientHeight||""!=r.val()||a(n).hasClass("nested-tab")?(a(s).scrollTop(o),r.show(),a("span.ui-icon-search",n).removeClass("unused")):(r.hide(),a("span.ui-icon-search",n).addClass("unused"))},t.newPanel.data("refreshPanel",i),t.newHeader.data("refreshPanel",i),t.newHeader.append(a('<span class="ui-icon ui-icon-search"></span>').on("click",function(e){t.newPanel.animate({scrollTop:t.newPanel.scrollTop()>0?0:o},300,function(){t.newPanel.scrollTop()>0?a("input.widget-filter",s).blur():a("input.widget-filter",s).focus()}),e.stopPropagation(),e.preventDefault()}))),r.val(""),i()}}}),a(document).on("click","ul.tag-group",function(e){a(this).toggleClass("folded"),a(this).parents(".widget-root").data("refreshPanel").call()}),a(document).on("keyup","#accordion input.widget-filter",function(e){var t,i=a(this).val().toLowerCase(),n=a(this).parent("div.widget-root");27==(e.keyCode||e.which)&&a(this).val(i=""),""==i?a("li,ul",n[0]).show():a("li>a",n[0]).each(function(){var e=a(this).closest("ul.tag-group"),n=a(this).parent();t=e.data("hidden")||0,n.hasClass("category")||(this.title.toLowerCase().indexOf(i)>=0||this.innerText.toLowerCase().indexOf(i)>=0?n.show():(n.hide(),++t)),e.length&&t&&e.data("hidden",t)}),a("ul.tag-group",n[0]).each(function(){var e=a(this);t=parseInt(e.data("hidden"))||0,e.children().length>t+1?e.show().removeClass("folded"):e.hide().addClass("folded"),e.data("hidden",null)})});var e,t=a("#result-tabs"),i=this;t.tabs({}),a("#accordion-resizer").resizable({minWidth:150,maxWidth:450,grid:[10,10],handles:"e",start:function(a,i){e={width:t.width(),height:t.height()}},resize:function(n,s){i.accordion.accordion("refresh"),a("#query-sticky-wrapper").width(i.accordion.width()),a(this).width(function(e,t){return t-7}),t.width(e.width+s.originalSize.width-s.size.width)}}),a(".query-left#query").sticky({topSpacing:this.topSpacing,widthFromWrapper:!1})},initComm:function(){var n,s,d=t(e.Requesting,e.Spying,e.Pivoting,i.PivotWidgeting,i.RangeWidgeting),u=t(e.Requesting,e.Faceting,i.AccordionExpansion,i.TagWidget);this.manager=n=new(t(e.Management,e.Configuring,e.QueryingJson,i.Translation,i.NestedSolrTranslation))(this),n.addListeners(new i.ResultWidget(a.extend(!0,{id:"result",target:a("#docs"),itemId:"s_uuid",nestLevel:"composition",onClick:function(e,t,n,r){if(s.findItem(t.s_uuid)<0){s.addItem(t);var o="",l=a('a[href="#basket_tab"]');l.html(i.ui.updateCounter(l.html(),s.length)),s.enumerateItems(function(e){o+=e.s_uuid+";"}),(o=i.ui.modifyURL(window.location.href,"basket",o))&&window.history.pushState({query:window.location.search},document.title,o),a("footer",this).toggleClass("add none")}},onCreated:function(e){a("footer",this).addClass("add")}},this))),n.addListeners(new(t(e.Widgets.Pager))({id:"pager",target:a("#pager"),prevLabel:"&lt;",nextLabel:"&gt;",innerWindow:1,renderHeader:function(e,t,i){a("#pager-header").html("<span>displaying "+Math.min(i,t+1)+" to "+Math.min(i,t+e)+" of "+i+"</span>")}}));for(var c=0,p=this.facets.length;c<p;++c){var h=this.facets[c],g=new u(a.extend({target:this.accordion,expansionTemplate:"#tab-topcategory",subtarget:"ul",multivalue:this.multipleSelection,aggregate:this.aggregateFacets,exclusion:this.multipleSelection||this.keepAllFacets,useJson:!0,renderItem:r,init:o,onUpdated:l,nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"},classes:h.color},h));g.afterTranslation=function(e){this.populate(this.getFacetCounts(e.facets))},n.addListeners(g)}n.addListeners(new d({id:"studies",target:this.accordion,subtarget:"ul",expansionTemplate:"#tab-topcategory",before:"#cell_header",field:"loValue_d",lookupMap:this.lookupMap,pivot:this.pivot,statistics:{min:"min(loValue_d)",max:"max(loValue_d)",avg:"avg(loValue_d)"},slidersTarget:a("#sliders"),multivalue:this.multipleSelection,aggregate:this.aggregateFacets,exclusion:this.multipleSelection||this.keepAllFacets,useJson:!0,renderTag:r,classes:"dynamic-tab",nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"}})),n.addListeners(new i.CurrentSearchWidget({id:"current",target:a("#selection"),renderItem:r,useJson:!0})),this.basket=s=new(t(i.ListWidget,i.ItemListWidget))(a.extend(!0,{id:"basket",target:a("#basket-docs"),summaryRenderers:this.summaryRenderers,itemId:"s_uuid",onClick:function(e,t){if(!1!==s.eraseItem(t.s_uuid)){a(this).remove();var n="",r=a('a[href="#basket_tab"]'),o=a("#result_"+t.s_uuid);r.html(i.ui.updateCounter(r.html(),s.length)),s.enumerateItems(function(e){n+=e.s_uuid+";"}),(n=i.ui.modifyURL(window.location.href,"basket",n))&&window.history.pushState({query:window.location.search},document.title,n),o.length>0&&a("footer",o[0]).toggleClass("add none")}else console.log("Trying to remove from basket an inexistent entry: "+JSON.stringify(t))},onCreated:function(e){a("footer",this).addClass("remove")}},this)),t.act(this,this.onPreInit,n),n.init(),n.doRequest()},updateButton:function(e){return b=a("button",e),a(e).find("input[name=export_dataset]").val()?this.manager.getParameter("json.filter").length||"filtered"!=e.export_dataset.value?a(e).find("input[name=export_dataset]").val()&&b.button("enable").button("option","label","Download "+a("#export_dataset :radio:checked + label").text().toLowerCase()+" as "+a(e.export_format).data("name").toUpperCase()):b.button("disable").button("option","label","No filters selected..."):b.button("option","label","No target dataset selected..."),b},initExport:function(){var t=this;this.prepareFormats(),this.prepareTypes(),a("#export_dataset").buttonset(),a("#export_type").buttonset(),a("#export_dataset input").on("change",function(e){t.updateButton(this.form)}),a("#export_tab button").button({disabled:!0}),a("#export_tab form").on("submit",function(i){var n=this,s=(s=n.export_format.value).substr(s.indexOf("/")+1),r=t.exportFormats[a(".data_formats .selected").data("index")],o=t.exportTypes[a(n).find("input[name=export_type]:checked").data("index")],l=o.server||r.server,d=t.manager.getParameter("json.filter"),u=[],c=[],p=null,h=function(e,a){var i={value:e.value,name:a||e.name};if(e.domain&&"parent"==e.domain.type)if(o.exportLevel){var n=t.exportLevels[o.exportLevel];e.value&&!e.value.match(n.fieldsRegExp)||(i.domain=n.domain)}else i.domain=e.domain;return i},g=function(){for(var a=0,i=d.length;a<i;a++){var n=d[a];u.push(e.stringifyParameter(h(n,"fq"))),c.push(e.stringifyValue(n).replace(/"|\\/g,"\\$&"))}u.push(e.stringifyParameter(h(t.manager.getParameter("q")))||"*:*")};return"filtered"!=n.export_dataset.value&&(p=[],t.basket.enumerateItems(function(e){p.push(e.s_uuid)})),"ambitUrl"==l?p?(n.search.value=p.join(" "),n.action=t.ambitUrl+"query/substance/study/uuid?media="+encodeURIComponent(n.export_format.value)):(g(),u.push("wt=json","fl=s_uuid_hs"),a.ajax({url:t.solrUrl+"select?"+u.join("&"),async:!1,dataType:"json",success:function(e){var i=[];a.each(e.response.docs,function(e,t){i.push(t.s_uuid_hs)}),n.search.value=i.join(" "),n.action=t.ambitUrl+"query/substance/study/uuid?media="+encodeURIComponent(n.export_format.value)}})):(g(),p&&u.push("fq="+encodeURIComponent(("study"==o.exportLevel?"s_uuid_s":"s_uuid_hs")+":("+p.join(" ")+")")),Array.prototype.push.apply(u,t.exportSolrDefaults),o.extraParams&&Array.prototype.push.apply(u,o.extraParams),u.push("fl="+encodeURIComponent(o.fields.replace("{{filter}}",c.length>1?"("+c.join(" AND ")+")":c.length>0?c[0]:o.defaultFilter))),u.push("rows="+t.exportMaxRows),"tsv"==s?u.push("wt=csv","csv.separator=%09"):u.push("wt="+s),n.action=t[l]+"select?"+u.join("&")),!0}),a("#result-tabs").tabs({activate:function(e,i){if("export_tab"==i.newPanel[0].id){t.basket.length&&a("input#selected_data").prop("checked",!0),a("button",i.newPanel[0]).button("disable").button("option","label","No output format selected...");var n=t.manager.getParameter("json.filter").length>0;a("#selected_data")[0].disabled=t.basket.length<1,a("#filtered_data")[0].disabled=!n,t.basket.length?(a(".data_formats").removeClass("disabled"),a("#export_type").buttonset("enable"),a(".warning-message").hide(),a("#selected_data")[0].checked=!0):(a("#filtered_data")[0].checked=n,n||t.manager.getParameter("q").value.length>0?(a(".data_formats").removeClass("disabled"),a("#export_type").buttonset("enable"),a(".warning-message").hide()):(a(".data_formats").addClass("disabled"),a("#export_type").buttonset("disable"),a(".warning-message").show())),a(".data_formats .jtox-ds-download a").first().trigger("click"),a("#export_dataset").buttonset("refresh")}}})},prepareFormats:function(){var e=a("#export_tab div.data_formats");self=this;for(var t=0,n=this.exportFormats.length;t<n;++t){var s=i.ui.fillTemplate("#export-format",this.exportFormats[t]);s.data("index",t),e.append(s),a("a",e[0]).on("click",function(e){var t=a(this),i=t.closest("form")[0];if(!t.hasClass("disabled")&&!t.hasClass("selected")){var n=t.closest("div.data_formats");i.export_format.value=t.data("mime"),a(i.export_format).data("name",t.data("name")),self.updateButton(i),a("div",n[0]).removeClass("selected"),n.addClass("selected"),t.closest(".jtox-fadable").addClass("selected")}return!1})}},prepareTypes:function(){for(var e=a("#export_tab div#export_type"),t=this,n=0,s=this.exportTypes.length;n<s;++n){this.exportTypes[n].selected=0==n?'checked="checked"':"";var r=i.ui.fillTemplate("#export-type",this.exportTypes[n]);r.data("index",n),e.append(r),a("input[name=export_type]").on("change",function(e){var i=a(this);return a(".data_formats a").addClass("disabled"),t.exportTypes[i.data("index")].formats.split(",").forEach(function(e){a(".data_formats a[data-name="+e+"]").removeClass("disabled")}),a(".data_formats a:visible").not(".disabled").first().trigger("click"),!1})}}}}(Solr,asSys,jQuery,jToxKit),function(e,t,a,n){function buildValueRange(e,t){var a=" = ";return a+=null==e.min?"-&#x221E;":e.min,e.avg&&(a+="&#x2026;"+e.avg),a+="&#x2026;"+(null==e.max?"&#x221E;":e.max),t&&(a+=" "+n.ui.formatUnits(e.val).replace(/<sup>(2|3)<\/sup>/g,"&#x00B$1;").replace(/<sup>(\d)<\/sup>/g,"^$1")),a}function InnerTagWidgeting(e){this.id=e.id,this.pivotWidget=e.pivotWidget}var s=/\W/g;InnerTagWidgeting.prototype={pivotWidget:null,hasValue:function(e){return this.pivotWidget.hasValue(this.id+":"+e)},clickHandler:function(e){return this.pivotWidget.clickHandler(this.id+":"+e)},modifyTag:function(e){return e.hint=e.unit?"\n"+e.unit.buckets.map(function(e){return buildValueRange(e,!0)}).join("\n"):e.buildValueRange(e),e.color=this.color,e}};var r=t(n.TagWidget,InnerTagWidgeting);n.PivotWidgeting=function(e){t.extend(!0,this,t.common(e,this)),this.target=e.target,this.targets={},this.lastEnabled=0,this.initialPivotCounts=null},n.PivotWidgeting.prototype={__expects:["getFaceterEntry","getPivotEntry","getPivotCounts","auxHandler"],automatic:!1,renderTag:null,multivalue:!1,aggregate:!1,exclusion:!1,init:function(e){t.pass(this,n.PivotWidgeting,"init",e),this.manager=e,this.manager.getListener("current").registerWidget(this,!0)},addFaceter:function(e,a){var i=t.pass(this,n.PivotWidgeting,"addFaceter",e,a);return"object"==typeof e&&(i.color=e.color),a>this.lastEnabled&&!e.disabled&&(this.lastEnabled=a),i},afterTranslation:function(e){var r=this.getPivotCounts(e.facets);for(t.pass(this,n.PivotWidgeting,"afterTranslation",e),i=0;i<r.length;++i){var o=r[i],l=o.val.replace(s,"_"),d=this.targets[l];d?d.target.children("ul").hide():(this.targets[l]=d=new n.AccordionExpansion(a.extend(!0,{},this.settings,this.getFaceterEntry(0),{id:l,title:o.val})),d.updateHandler=this.updateHandler(d),d.target.children().last().remove()),this.traversePivot(d.target,o,1),d.updateHandler(o.count)}this.target.accordion("refresh")},updateHandler:function(e){var t=e.getHeaderText();return function(e){t.textContent=n.ui.updateCounter(t.textContent,e)}},prepareTag:function(e){var t=this.parseValue(e);return{title:t.value,color:this.faceters[t.id].color,count:"i",onMain:this.unclickHandler(e),onAux:this.auxHandler(e)}},traversePivot:function(e,t,i){var o=[],l=this.getPivotEntry(i),d=t[l.id].buckets;if(i===this.lastEnabled){var u=e.data("widget");u?e.children().slice(1).remove():((u=new r({id:l.id,color:l.color,renderItem:this.renderTag,pivotWidget:this,target:e,multivalue:this.multivalue,aggregate:this.aggregate,exclusion:this.exclusion})).init(this.manager),e.data({widget:u,id:l.id})),u.populate(d,!0),o=[]}else if(null!=d)for(var c=0,p=d.length;c<p;++c){var h,g=d[c],m=g.val.replace(s,"_");e.children().length>1?h=a("#"+m,e[0]).show():(h=n.ui.fillTemplate(a("#tag-facet"),l).attr("id",m),g.title=g.val,g.onMain=this.clickHandler(l.id+":"+g.val),g.hint=buildValueRange(g),h.append(this.renderTag(g).addClass("category title").addClass(l.color)),o.push(h)),this.traversePivot(h,g,i+1)}e.append(o)}}}(Solr,asSys,jQuery,jToxKit),function(e,t,a,i){function SimpleRanger(e){this.sliderRoot=e.sliderRoot}SimpleRanger.prototype.__expects=["addValue","doRequest"],SimpleRanger.prototype.targetValue=null,SimpleRanger.prototype.updateHandler=function(){var e=this;return function(t){e.addValue(t)&&(e.sliderRoot.updateRequest=!0,e.doRequest())}},SimpleRanger.prototype.doRequest=function(){this.manager.doRequest()},SingleRangeWidget=t(e.Ranging,e.Patterning,i.SliderWidget,SimpleRanger,e.Delaying);var n={facet:!0,rows:0,fl:"id","facet.limit":-1,"facet.mincount":1,echoParams:"none"};i.RangeWidgeting=function(e){t.extend(!0,this,t.common(e,this)),this.slidersTarget=a(e.slidersTarget),this.lookupMap=e.lookupMap||{},this.pivotMap=null,this.rangeWidgets=[],Array.isArray(this.titleSkips)||(this.titleSkips=[this.titleSkips])},i.RangeWidgeting.prototype={__expects:["getPivotEntry","getPivotCounts"],field:null,titleSkips:null,init:function(e){t.pass(this,i.RangeWidgeting,"init",e),this.manager=e;var n=this;n.applyCommand=a("#sliders-controls a.command.apply").on("click",function(e){return n.skipClear=!0,n.manager.doRequest(),!1}),a("#sliders-controls a.command.close").on("click",function(e){return n.rangeRemove(),!1})},afterTranslation:function(e){var a=this.getPivotCounts(e.facets);if(t.pass(this,i.RangeWidgeting,"afterTranslation",e),this.pivotMap)if(this.updateRequest){if(this.rangeWidgets.length>0)for(var n,s,r=this.buildPivotMap(a),o=0,l=this.rangeWidgets.length;o<l;++o)s=r[(n=this.rangeWidgets[o]).targetValue],n.updateSlider([s[o].min,s[o].max])}else this.rangeRemove();else{var d=this.manager.getParameter("q").value||"";d&&"*:*"!=d||this.manager.getParameter(this.useJson?"json.filter":"fq").value||(this.pivotMap=this.buildPivotMap(a))}this.updateRequest=!1},buildPivotMap:function(t){var a=this,i={};traverser=function(t,n,s,r){var o,l=a.getPivotEntry(n),d=l.id,u=l.color;if(l.ranging&&!l.disabled&&(r=d+":"+t.val),s+=(t.val?l.field+":"+e.escapeValue(t.val):"-"+l.field+":*")+" ",o=t,null!=(l=a.getPivotEntry(n+1))&&(t=t[l.id].buckets),null!=l&&t.length)for(var c=0,p=t.length;c<p;++c)traverser(t[c],n+1,s,r);else{var h=i[r];h===undefined&&(i[r]=h=[]),h.push({id:d,pattern:s,color:u,min:o.min,max:o.max,avg:o.avg,val:o.val,count:o.count})}};for(var n=0;n<t.length;++n)traverser(t[n],0,"");return i},rangeRemove:function(){this.slidersTarget.empty().parent().removeClass("active");for(var e=0,t=this.rangeWidgets.length;e<t;++e)this.rangeWidgets[e].clearValues();this.rangeWidgets=[],this.lastPivotMap=this.lastPivotValue=null},buildTitle:function(e,t){for(var a=e.pattern.replace(/\\"/g,"%0022").match(/\w+:([^\s:\/"]+|"[^"]+")/g),i=[],n=0;n<a.length;++n){var s=a[n].match(/(\w+):([^\s:\/"]+|"[^"]+")/),r=s[2].replace(/^\s*\(\s*|\s*\)\s*$/g,"");s[1].match(t)||i.push(this.lookupMap[r]||r)}return i.join("/")+" <i>("+e.count+")</i>"},ensurePivotMap:function(e){if(null!=this.pivotMap)return!0;var t=this.useJson?"json.filter":"fq",a=this;return this.doSpying(function(e){e.removeParameters(t),e.removeParameters("fl"),e.getParameter("q").value="",e.mergeParameters(n)},function(t){a.pivotMap=a.buildPivotMap(a.getPivotCounts(t.facets)),a.openRangers(e)}),!1},openRangers:function(e){var t=this.pivotMap[e],n=(this.lastPivotMap=this.buildPivotMap(this.getPivotCounts()))[e];this.lastPivotValue=e,this.slidersTarget.empty().parent().addClass("active");for(var s=0,r=t.length;s<r;++s){var o,l=t[s],d=n[s],u={},c=i.ui.fillTemplate("#slider-one");this.slidersTarget.append(c),u.id=l.id,u.targetValue=e,u.color=l.color,u.field=this.field,u.limits=[l.min,l.max],u.initial=[d.min,d.max],u.target=c,u.isRange=!0,u.valuePattern=l.pattern+"{{v}}",u.automatic=!0,u.width=parseInt(this.slidersTarget.width()-a("#sliders-controls").width()-20)/(Math.min(r,2)+.1),u.title=this.buildTitle(d,/^unit[_shd]*|^effectendpoint[_shd]*/),u.units="unit"==d.id?i.ui.formatUnits(d.val):"",u.useJson=this.useJson,u.domain=this.domain,u.sliderRoot=this,this.rangeWidgets.push(o=new SingleRangeWidget(u)),o.init(this.manager)}},auxHandler:function(e){var t=this;return function(a){return a.stopPropagation(),t.rangeRemove(),e!=t.lastPivotValue&&t.ensurePivotMap(e)&&t.openRangers(e),!1}},clearValues:function(){this.rangeRemove(),t.pass(this,i.RangeWidgeting,"clearValues")}}}(Solr,asSys,jQuery,jToxKit),function(e,t,a,i){var n='<a href="{{href}}" title="{{hint}}" target="{{target}}" class="{{css}}">{{value}}</a>';i.ItemListWidget=function(e){e.baseUrl=i.ui.fixBaseUrl(e.baseUrl)+"/",t.extend(!0,this,t.common(e,this)),this.lookupMap=e.lookupMap||{},this.target=e.target,this.id=e.id},i.ItemListWidget.prototype={baseUrl:"",summaryPrimes:["RESULTS"],tagDbs:{},onCreated:null,onClick:null,summaryRenderers:{RESULTS:function(e,t){var a=this;return e.map(function(e){return e.split(".").map(function(e){return a.lookupMap[e]||e}).join(".")})},REFOWNERS:function(e,t){return{topic:"Study Providers",content:e.map(function(e){return i.ui.formatString(n,{href:"#",hint:"Freetext search",target:"_self",value:e,css:"freetext_selector"})})}},REFS:function(e,t){return{topic:"References",content:e.map(function(e){var t=e.match(/^doi:(.+)$/);return t=null!=t?"https://www.doi.org/"+t[1]:e,i.ui.formatString(t.match(/^https?:\/\//)?n:'<span title="{{hint}}" class="{{css}}">{{value}}</span>',{href:t,hint:"External reference",target:"ref",value:e})})}}},renderItem:function(e){var t=this,i=a(this.renderSubstance(e));return i.length?(a(this.target).append(i),"function"==typeof this.onClick&&a("a.command",i[0]).on("click",function(a){t.onClick.call(i[0],a,e,t)}),"function"==typeof this.onCreated&&this.onCreated.call(i,e,this),a("a.more",i[0]).on("click",function(e){e.preventDefault(),e.stopPropagation();var t=a(this),i=a(".more-less",t.parent()[0]);return i.is(":visible")?(i.hide(),t.text("more")):(i.show(),t.text("less")),!1}),null):null},renderSubstance:function(e){var t=a("#summary-item").html(),n=this.buildSummary(e),s=this.getBaseUrl(e),r=function(e){return e.map(function(e){return i.ui.formatString(t,e)}).join("")},o={logo:this.tagDbs[e.dbtag_hss]&&this.tagDbs[e.dbtag_hss].icon||"images/logo.png",link:"#",href:"#",title:(e.publicname||e.name)+(e.pubname===e.name?"":"  ("+e.name+")")+(null==e.substanceType?"":" "+(this.lookupMap[e.substanceType]||e.substanceType)),composition:this.renderComposition(e,'<a href="'+s+e.s_uuid+'/structure" title="Composition" target="'+e.s_uuid+'">&hellip;</a>').join("<br/>"),summary:n.length>0?r(n.splice(0,this.summaryPrimes.length)):"",item_id:(this.prefix||this.id||"item")+"_"+e.s_uuid,footer:'<a href="'+s+e.s_uuid+'" title="Substance" target="'+e.s_uuid+'">Material</a><a href="'+s+e.s_uuid+'/structure" title="Composition" target="'+e.s_uuid+'">Composition</a><a href="'+s+e.s_uuid+'/study" title="Study" target="'+e.s_uuid+'">Studies</a>'};if(n.length>0&&(o.summary+='<a href="#" class="more">more</a><div class="more-less" style="display:none;">'+r(n)+"</div>"),null==e.content)o.link=s+e.s_uuid,o.href=o.link+"/study",o.href_title="Study",o.href_target=e.s_uuid;else{var l="External database";if(e.owner_name&&0===e.owner_name.lastIndexOf("caNano",0)?(o.logo="images/canano.jpg",o.href_title="caNanoLab: "+o.link,o.href_target=l="caNanoLab",o.footer=""):(o.logo="images/external.png",o.href_title="External: "+o.link,o.href_target="external"),e.content.length>0){o.link=e.content[0];for(var d=0,u=e.content.length;d<u;d++)o.footer+='<a href="'+e.content[d]+'" target="external">'+l+"</a>"}}return i.ui.fillTemplate("#result-item",o)},getBaseUrl:function(e){if(this.tagDbs[e.dbtag_hss]!==undefined){var t=this.tagDbs[e.dbtag_hss].server;return t+("/"!=t.substr(-1)?"/substance/":"substance/")}return this.baseUrl},renderComposition:function(e,a){var s=[],r=e._extended_&&e._extended_.composition;if(r){var o={};t.each(r,function(e){var a=o[e.component_s],s=[];a===undefined&&(o[e.component_s]=a=[]),t.each(e,function(e,t){var a=t.match(/^(\w+)_[shd]+$/);(t=a&&a[1]||t).match(/type|id|component/)||s.push(i.ui.formatString(n,{href:"#",hint:"Freetext search on '"+t+"'",target:"_self",value:e,css:"freetext_selector"}))}),a.push(s.join(", "))}),t.each(o,function(e,t){for(var i="",n=0;n<e.length;++n)""!=e[n]&&(i+=0==n?": ":"; ",e.length>1&&(i+="<strong>["+(n+1)+"]</strong>&nbsp;"),i+=e[n]);""===i&&(i=":&nbsp;"+a),i=t+" ("+e.length+")"+i,s.push(i)})}return s},buildSummary:function(e){var a=this,i=[];return t.each(e,function(e,t){var n=t.match(/^SUMMARY\.([^_]+)_?[hsd]*$/);if(n){n=n[1];var s=a.summaryRenderers[n]||a.summaryRenderers._,r="function"==typeof s?s.call(a,e,n):e;if(r){"object"!=typeof r||Array.isArray(r)?r={topic:n.toLowerCase(),values:r}:null==r.topic&&(r.topic=n.toLowerCase()),r.content||(r.content=Array.isArray(r.values)?r.values.join(", "):r.values.toString());var o=a.summaryPrimes.indexOf(n);o>-1&&o<i.length?i.splice(o,0,r):i.push(r)}}}),i}},i.ResultWidgeting=function(e){t.extend(!0,this,t.common(e,this))},i.ResultWidgeting.prototype={__expects:["populate"],init:function(e){t.pass(this,i.ResultWidgeting,"init",e),this.manager=e},beforeRequest:function(){a(this.target).html(a("<img>").attr("src","images/ajax-loader.gif"))},afterTranslation:function(e){a(this.target).empty(),this.populate(e.entries)}},i.ResultWidget=t(e.Listing,i.ListWidget,i.ItemListWidget,i.ResultWidgeting)}(Solr,asSys,jQuery,jToxKit),jToxKit.ui.templates["faceted-search-kit"]='<div class="query-container">\x3c!-- left --\x3e<div id="query" class="query-left"><div id="accordion-resizer" class="ui-widget-content"><div id="accordion"></div></div></div>\x3c!-- right --\x3e<div id="result-tabs" class="query-right"><ul><li><a href="#hits_tab">Hits list</a></li><li><a href="#basket_tab">Selection</a></li><li class="jtox-ds-export"><a href="#export_tab">Export</a></li></ul><div id="hits_tab"><div class="row remove-bottom"><ul class="tags remove-bottom" id="selection"></ul><footer><div id="sliders-controls"><a href="#" class="jtox-fadable command close">Close</a></div><div id="sliders"></div></footer></div><div id="navigation"><ul id="pager"></ul><div id="pager-header"></div></div><div class="docs_wrapper"><section id="docs" class="item-list"></section></div></div><div id="basket_tab"><section id="basket-docs" class="item-list"></section><div style="padding-top: 70px;"></div></div><div id="export_tab"><form target="_blank" method="post"><input type="hidden" name="search"/><h6>Select dataset to export</h6><div id="export_dataset"><input type="radio" value="filtered" name="export_dataset" id="filtered_data" checked="checked"/><label for="filtered_data">Filtered entries</label><input type="radio" value="selected" name="export_dataset" id="selected_data"/><label for="selected_data">Selected entries</label></div><h6>Select export type</h6><div id="export_type"></div><h6>Select output format</h6><input type="hidden" name="export_format" id="export_format"/><div class="data_formats"></div><br/><button type="submit" name="export_go" data-prefix="Download">?</button><div class="ui-state-error ui-corner-all warning-message" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><strong>Warning:</strong>Please either add entries to the selection or specify a query</p></div></form></div></div>\x3c!-- query container --\x3e</div>',jToxKit.ui.templates["faceted-search-templates"]='<section id="result-item"><article id="{{item_id}}" class="item"><header>{{title}}<a href="{{href}}" title="{{href_title}}" target="{{href_target}}"><span class="ui-icon ui-icon-extlink" style="float:right;margin:0;"></span></a></header><a href="{{link}}" title="{{link}}" class="avatar" target="_blank"><img jt-src="{{logo}}"/></a><div class="composition">{{composition}}</div>{{summary}}<footer class="links">{{footer}}<a href="#" class="add jtox-fadable command">Add to Selection</a><a href="#" class="remove jtox-fadable command">Remove from Selection</a><a href="#" class="none jtox-fadable command">Already added</a></footer></article></section><div id="summary-item"><div class="one-summary"><span class="topic">{{topic}}:</span><span class="value">{{content}}</span></div></div><div id="tag-facet"><ul class="tags tag-group folded"></ul></div><div id="tab-topcategory"><h3 id="{{id}}_header" class="nested-tab">{{title}}</h3><div id="{{id}}" class="widget-content widget-root"><input type="text" placeholder="Filter_" class="widget-filter"/><ul class="widget-content tags remove-bottom" data-color="{{color}}"></ul></div></div><div id="slider-one"><input type="hidden"/></div><div id="export-type"><input type="radio" value="{{fields}}" {{selected}} name="export_type" id="{{name}}"/><label for="{{name}}">{{name}}</label></div><div id="export-format"><div class="jtox-inline jtox-ds-download jtox-fadable"><a target="_blank" data-name="{{name}}" data-mime="{{mime}}" href="#"><img class="borderless" jt-src="{{icon}}"/></a></div></div>';