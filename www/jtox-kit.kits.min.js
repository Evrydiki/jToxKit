!function(t,e,i,a){CurrentSearchWidgeting=function(t){e.extend(!0,this,e.common(t,this)),this.target=t.target,this.id=t.id,this.manager=null,this.facetWidgets={},this.fqName=this.useJson?"json.filter":"fq"},CurrentSearchWidgeting.prototype={useJson:!1,renderItem:null,init:function(t){e.pass(this,CurrentSearchWidgeting,"init",t),this.manager=t},registerWidget:function(t,e){this.facetWidgets[t.id]=e},afterTranslation:function(t){var e=this,i=[],a=this.manager.getParameter("q"),n=this.manager.getAllValues(this.fqName);a.value&&!a.value.match(/^(\*:)?\*$/)&&i.push(e.renderItem({title:a.value,count:"x",onMain:function(){return a.value="",e.manager.doRequest(),!1}}).addClass("tag_fixed"));for(var s=0,r=null!=n?n.length:0;s<r;s++){var o=n[s],l=null;for(var d in e.facetWidgets){var u=e.manager.getListener(d),l=u.fqParse(o);if(l)break}if(null!=l){Array.isArray(l)||(l=[l]);for(var c=0,h=l.length;c<h;++c){var p,g=l[c],f="function"==typeof u.prepareTag?u.prepareTag(g):{title:g,count:"x",color:u.color,onMain:u.unclickHandler(g)};i.push(p=e.renderItem(f).addClass("tag_selected "+(f.onAux?"tag_open":"tag_fixed"))),h>1&&p.addClass("tag_combined")}h>1&&p.addClass("tag_last")}}i.length?(i.push(e.renderItem({title:"Clear",onMain:function(){a.value="";for(var t in e.facetWidgets)e.manager.getListener(t).clearValues();return e.manager.doRequest(),!1}}).addClass("tag_selected tag_clear tag_fixed")),this.target.empty().addClass("tags").append(i)):this.target.removeClass("tags").html("<li>No filters selected!</li>")}},a.CurrentSearchWidget=e(CurrentSearchWidgeting)}(Solr,asSys,jQuery,jToxKit),function(t,e,i,a){var n={},s={nestingRules:{composition:{field:"type_s",parent:"substance",limit:100}},servlet:"autophrase",connector:i,onPrepare:function(t){var e=t.url.indexOf("?");this.proxyUrl?(t.data={query:t.url.substr(e+1)},t.url=this.proxyUrl,t.type=t.method="POST"):t.url+=(e<0?"?":"&")+"wt=json"},solrParameters:{"facet.limit":-1,"facet.mincount":1,echoParams:"none",fl:"id","json.nl":"map","q.alt":"*:*"},topSpacing:10,nestingRules:{composition:{field:"type_s",parent:"substance",limit:100}},exportMaxRows:999999,exportTypes:[],listingFields:[],facets:[],summaryRenderers:{}},r=function(t){var e,a=e=t.title.replace(/^\"(.+)\"$/,"$1");a=e.replace(/^caNanoLab\./,"").replace(/^http\:\/\/dx\.doi\.org/,""),a=(n[a]||a).replace("NPO_","").replace(" nanoparticle","");var s=i("<span/>").html(t.count||0);"function"==typeof t.onAux&&s.click(t.onAux);var r=i("<li/>").append(i('<a href="#" class="tag" title="'+e+" "+(t.hint||"")+(a!=e?" ["+e+"]":"")+'">'+a+"</a>").append(s));return"function"==typeof t.onMain&&r.click(t.onMain),t.color&&r.addClass(t.color),r},o=function(t){a.TagWidget.prototype.init.call(this,t),t.getListener("current").registerWidget(this)},l=function(t){var i=this.getHeaderText();i.textContent=a.ui.updateCounter(i.textContent,t),e.act(this,this.header.data("refreshPanel"))};a.FacetedSearch=function(t){this.id=null,e.extend(!0,this,s,t),"string"==typeof this.lookupMap&&(this.lookupMap=window[this.lookupMap]),null==this.lookupMap&&(this.lookupMap={}),n=this.lookupMap,i(t.target).html(a.ui.templates["faceted-search-kit"]),delete this.target,this.initDom(),this.initComm(),this.initExport()},a.FacetedSearch.prototype={initDom:function(){this.accordion=i("#accordion"),this.accordion.accordion({heightStyle:"content",collapsible:!0,animate:200,active:!1,activate:function(t,e){if(e.newPanel&&e.newPanel[0]){var a,n=e.newHeader[0],s=e.newPanel[0],r=i("input.widget-filter",s),o=r.outerHeight(!0);i("span.ui-icon-search",n).length?a=e.newPanel.data("refreshPanel"):(a=function(){s.scrollHeight>s.clientHeight||""!=r.val()||i(n).hasClass("nested-tab")?(i(s).scrollTop(o),r.show(),i("span.ui-icon-search",n).removeClass("unused")):(r.hide(),i("span.ui-icon-search",n).addClass("unused"))},e.newPanel.data("refreshPanel",a),e.newHeader.data("refreshPanel",a),e.newHeader.append(i('<span class="ui-icon ui-icon-search"></span>').on("click",function(t){e.newPanel.animate({scrollTop:e.newPanel.scrollTop()>0?0:o},300,function(){e.newPanel.scrollTop()>0?i("input.widget-filter",s).blur():i("input.widget-filter",s).focus()}),t.stopPropagation(),t.preventDefault()}))),r.val(""),a()}}}),i(document).on("click","ul.tag-group",function(t){i(this).toggleClass("folded"),i(this).parents(".widget-root").data("refreshPanel").call()}),i(document).on("keyup","#accordion input.widget-filter",function(t){var e,a=i(this).val().toLowerCase(),n=i(this).parent("div.widget-root");27==(t.keyCode||t.which)&&i(this).val(a=""),""==a?i("li,ul",n[0]).show():i("li>a",n[0]).each(function(){var t=i(this).closest("ul.tag-group"),n=i(this).parent();e=t.data("hidden")||0,n.hasClass("category")||(this.title.toLowerCase().indexOf(a)>=0||this.innerText.toLowerCase().indexOf(a)>=0?n.show():(n.hide(),++e)),t.length&&e&&t.data("hidden",e)}),i("ul.tag-group",n[0]).each(function(){var t=i(this);e=parseInt(t.data("hidden"))||0,t.children().length>e+1?t.show().removeClass("folded"):t.hide().addClass("folded"),t.data("hidden",null)})});var t,e=i("#result-tabs"),a=this;e.tabs({}),i("#accordion-resizer").resizable({minWidth:150,maxWidth:450,grid:[10,10],handles:"e",start:function(i,a){t={width:e.width(),height:e.height()}},resize:function(n,s){a.accordion.accordion("refresh"),i("#query-sticky-wrapper").width(a.accordion.width()),i(this).width(i(this).width()-7),e.width(t.width+s.originalSize.width-s.size.width)}}),i(".query-left#query").sticky({topSpacing:this.topSpacing,widthFromWrapper:!1})},initComm:function(){var n,s,d=e(t.Requesting,t.Pivoting,a.PivotWidgeting,a.RangeWidgeting),u=e(t.Requesting,t.Faceting,a.AccordionExpansion,a.TagWidget);this.manager=n=new(e(t.Management,t.Configuring,t.QueryingJson,a.Translation,a.NestedSolrTranslation))(this),n.addListeners(new a.ResultWidget(i.extend(!0,{id:"result",target:i("#docs"),itemId:"s_uuid",onClick:function(t,e,n,r){if(s.findItem(e.s_uuid)<0){s.addItem(e);var o="",l=i('a[href="#basket_tab"]');l.html(a.ui.updateCounter(l.html(),s.length)),s.enumerateItems(function(t){o+=t.s_uuid+";"}),(o=a.ui.modifyURL(window.location.href,"basket",o))&&window.history.pushState({query:window.location.search},document.title,o),i("footer",this).toggleClass("add none")}},onCreated:function(t){i("footer",this).addClass("add")}},this))),n.addListeners(new(e(t.Widgets.Pager))({id:"pager",target:i("#pager"),prevLabel:"&lt;",nextLabel:"&gt;",innerWindow:1,renderHeader:function(t,e,a){i("#pager-header").html("<span>displaying "+Math.min(a,e+1)+" to "+Math.min(a,e+t)+" of "+a+"</span>")}}));for(var c=0,h=this.facets.length;c<h;++c){var p=this.facets[c],g=new u(i.extend({target:this.accordion,expansionTemplate:"#tab-topcategory",subtarget:"ul",multivalue:!0,aggregate:!0,exclusion:!0,useJson:!0,renderItem:r,init:o,onUpdated:l,nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"},classes:p.color},p));g.afterTranslation=function(t){this.populate(this.getFacetCounts(t.facets))},n.addListeners(g)}n.addListeners(new d({id:"studies",target:this.accordion,subtarget:"ul",expansionTemplate:"#tab-topcategory",before:"#cell_header",field:"loValue_d",lookupMap:this.lookupMap,pivot:[{id:"topcategory",field:"topcategory_s",disabled:!0},{id:"endpointcategory",field:"endpointcategory_s",color:"blue"},{id:"effectendpoint",field:"effectendpoint_s",color:"green",ranging:!0},{id:"unit",field:"unit_s",disabled:!0,ranging:!0}],statistics:{min:"min(loValue_d)",max:"max(loValue_d)",avg:"avg(loValue_d)"},slidersTarget:i("#sliders"),multivalue:!0,aggregate:!0,exclusion:!0,useJson:!0,renderTag:r,classes:"dynamic-tab",nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"}})),n.addListeners(new a.CurrentSearchWidget({id:"current",target:i("#selection"),renderItem:r,useJson:!0})),this.basket=s=new(e(a.ListWidget,a.ItemListWidget))({id:"basket",target:i("#basket-docs"),summaryRenderers:this.summaryRenderers,itemId:"s_uuid",onClick:function(t,e){if(s.eraseItem(e.s_uuid)===!1)return void console.log("Trying to remove from basket an inexistent entry: "+JSON.stringify(e));i(this).remove();var n="",r=i('a[href="#basket_tab"]'),o=i("#result_"+e.s_uuid);r.html(a.ui.updateCounter(r.html(),s.length)),s.enumerateItems(function(t){n+=t.s_uuid+";"}),(n=a.ui.modifyURL(window.location.href,"basket",n))&&window.history.pushState({query:window.location.search},document.title,n),o.length>0&&i("footer",o[0]).toggleClass("add none")},onCreated:function(t){i("footer",this).addClass("remove")}}),e.act(this,this.onPreInit,n),n.init(),n.doRequest()},initExport:function(){for(var t=this,e=i("#export_tab div.data_types"),n=function(t){var e=this.form,a=i("button",this.form);return e.export_dataset.value?e.export_type.value&&a.button("enable").button("option","label","Download "+i("#export_dataset :radio:checked + label").text().toLowerCase()+" as "+this.form.export_type.value.toUpperCase()):a.button("option","label","No target dataset selected..."),a},s=0,r=this.exportTypes.length;s<r;++s){var o=a.ui.fillTemplate("#export-type",this.exportTypes[s]);e.append(o),i("a",o[0]).on("click",function(t){var e=i(this);if(!e.hasClass("selected")){var a=e.closest("form")[0],s=e.closest("div.data_types"),r=e.data("mime");a.export_type.value=r=r.substr(r.indexOf("/")+1),n.call(a.export_type,t),i("div",s[0]).removeClass("selected"),s.addClass("selected"),e.closest(".jtox-fadable").addClass("selected")}return!1})}i("#export_dataset").buttonset(),i("#export_dataset input").on("change",n),i("#export_tab button").button({disabled:!0}),i("#export_tab form").on("submit",function(e){var i=this,a=i.export_type.value,n=["rows="+Settings.exportMaxRows,"fl="+encodeURIComponent(Settings.exportFields)];if("tsv"==a?n.push("wt=csv","csv.separator=%09"):n.push("wt="+a),"filtered"==i.export_dataset.value){for(var s=t.manager.getAllValue("fq"),r=0,o=s.length;r<o;r++)s[r].value.match(/collapse/)||n.push("fq="+encodeURIComponent(s[r].value));i.q.value=t.manager.gerParameter("q").value}else{var l=[];Basket.enumerateItems(function(t){l.push(t.s_uuid)}),i.q.value="s_uuid:("+l.join(" ")+")"}return i.action=t.solrUrl+"select?"+n.join("&"),e.preventDefault(),i.submit(),!1}),i("#result-tabs").tabs({activate:function(e,a){if("export_tab"==a.newPanel[0].id){i("div",a.newPanel[0]).removeClass("selected"),i("button",a.newPanel[0]).button("disable").button("option","label","No output format selected...");var n=t.manager.getParameter("q"),s=t.manager.getParameter("fq").length>1||!!n&&"*:*"!=n;i("#selected_data")[0].disabled=t.basket.length<1,i("#selected_data")[0].checked=t.basket.length>0&&!s,i("#filtered_data")[0].disabled=!s,i("#filtered_data")[0].checked=s,i("#export_dataset").buttonset("refresh")}}})}}}(Solr,asSys,jQuery,jToxKit),function(t,e,a,n){function s(t,e){var i=" = ";return i+=null==t.min?"-&#x221E;":t.min,t.avg&&(i+="&#x2026;"+t.avg),i+="&#x2026;"+(null==t.max?"&#x221E;":t.max),e&&(i+=" "+n.ui.formatUnits(t.val).replace(/<sup>(2|3)<\/sup>/g,"&#x00B$1;").replace(/<sup>(\d)<\/sup>/g,"^$1")),i}function r(t){this.id=t.id,this.pivotWidget=t.pivotWidget}var o=/\W/g;r.prototype={pivotWidget:null,hasValue:function(t){return this.pivotWidget.hasValue(this.id+":"+t)},clickHandler:function(t){return this.pivotWidget.clickHandler(this.id+":"+t)},modifyTag:function(t){return t.hint=t.unit?"\n"+t.unit.buckets.map(function(t){return s(t,!0)}).join("\n"):t.buildValueRange(t),t.color=this.color,t}};var l=e(n.TagWidget,r);n.PivotWidgeting=function(t){e.extend(!0,this,e.common(t,this)),this.target=t.target,this.targets={},this.lastEnabled=0,this.initialPivotCounts=null},n.PivotWidgeting.prototype={__expects:["getFaceterEntry","getPivotEntry","getPivotCounts","auxHandler"],automatic:!1,renderTag:null,init:function(t){e.pass(this,n.PivotWidgeting,"init",t),this.manager=t,this.manager.getListener("current").registerWidget(this,!0)},addFaceter:function(t,i){var a=e.pass(this,n.PivotWidgeting,"addFaceter",t,i);return"object"==typeof t&&(a.color=t.color),i>this.lastEnabled&&!t.disabled&&(this.lastEnabled=i),a},afterTranslation:function(t){var s=this.getPivotCounts(t.facets);for(e.pass(this,n.PivotWidgeting,"afterTranslation",t),i=0;i<s.length;++i){var r=s[i],l=r.val.replace(o,"_"),d=this.targets[l];d?d.target.children("ul").hide():(this.targets[l]=d=new n.AccordionExpansion(a.extend(!0,{},this.settings,this.getFaceterEntry(0),{id:l,title:r.val})),d.updateHandler=this.updateHandler(d),d.target.children().last().remove()),this.traversePivot(d.target,r,1),d.updateHandler(r.count)}this.target.accordion("refresh")},updateHandler:function(t){var e=t.getHeaderText();return function(t){e.textContent=n.ui.updateCounter(e.textContent,t)}},prepareTag:function(t){var e=this.parseValue(t);return{title:e.value,color:this.faceters[e.id].color,count:"i",onMain:this.unclickHandler(t),onAux:this.auxHandler(t)}},traversePivot:function(t,e,i){var r=[],d=this.getPivotEntry(i),u=e[d.id].buckets;if(i===this.lastEnabled){var c=t.data("widget");c?t.children().slice(1).remove():(c=new l({id:d.id,color:d.color,renderItem:this.renderTag,pivotWidget:this,target:t}),c.init(this.manager),t.data({widget:c,id:d.id})),c.populate(u,!0),r=[]}else if(null!=u)for(var h=0,p=u.length;h<p;++h){var g,f=u[h],m=f.val.replace(o,"_");t.children().length>1?g=a("#"+m,t[0]).show():(g=n.ui.fillTemplate(a("#tag-facet"),d).attr("id",m),f.title=f.val,f.onMain=this.clickHandler(d.id+":"+f.val),f.hint=s(f),g.append(this.renderTag(f).addClass("category title").addClass(d.color)),r.push(g)),this.traversePivot(g,f,i+1)}t.append(r)}}}(Solr,asSys,jQuery,jToxKit),function(t,e,i,a){function n(t){this.sliderRoot=t.sliderRoot}n.prototype.__expects=["addValue","doRequest"],n.prototype.targetValue=null,n.prototype.updateHandler=function(){var t=this;return function(e){t.addValue(e)&&(t.sliderRoot.updateRequest=!0,t.doRequest())}},n.prototype.doRequest=function(){this.manager.doRequest()},SingleRangeWidget=e(t.Ranging,t.Patterning,a.SliderWidget,n,t.Delaying),a.RangeWidgeting=function(t){e.extend(!0,this,e.common(t,this)),this.slidersTarget=i(t.slidersTarget),this.lookupMap=t.lookupMap||{},this.pivotMap=null,this.rangeWidgets=[],Array.isArray(this.titleSkips)||(this.titleSkips=[this.titleSkips])},a.RangeWidgeting.prototype={__expects:["getPivotEntry","getPivotCounts"],field:null,titleSkips:null,init:function(t){e.pass(this,a.RangeWidgeting,"init",t),this.manager=t;var n=this;n.applyCommand=i("#sliders-controls a.command.apply").on("click",function(t){return n.skipClear=!0,n.manager.doRequest(),!1}),i("#sliders-controls a.command.close").on("click",function(t){return n.rangeRemove(),!1})},afterTranslation:function(t){var i=this.getPivotCounts(t.facets);if(e.pass(this,a.RangeWidgeting,"afterTranslation",t),this.pivotMap)if(this.updateRequest){if(this.rangeWidgets.length>0)for(var n,s,r=this.buildPivotMap(i),o=0,l=this.rangeWidgets.length;o<l;++o)n=this.rangeWidgets[o],s=r[n.targetValue],n.updateSlider([s[o].min,s[o].max])}else this.rangeRemove();else this.pivotMap=this.buildPivotMap(i);this.updateRequest=!1},buildPivotMap:function(e){var i=this,a={};traverser=function(e,n,s,r){var o,l=i.getPivotEntry(n),d=l.id,u=l.color;if(l.ranging&&!l.disabled&&(r=d+":"+e.val),s+=(e.val?l.field+":"+t.escapeValue(e.val):"-"+l.field+":*")+" ",o=e,l=i.getPivotEntry(n+1),null!=l&&(e=e[l.id].buckets),null!=l&&e.length)for(var c=0,h=e.length;c<h;++c)traverser(e[c],n+1,s,r);else{var p=a[r];void 0===p&&(a[r]=p=[]),p.push({id:d,pattern:s,color:u,min:o.min,max:o.max,avg:o.avg,val:o.val,count:o.count})}};for(var n=0;n<e.length;++n)traverser(e[n],0,"");return a},rangeRemove:function(){this.slidersTarget.empty().parent().removeClass("active");for(var t=0,e=this.rangeWidgets.length;t<e;++t)this.rangeWidgets[t].clearValues();this.rangeWidgets=[],this.lastPivotMap=this.lastPivotValue=null},buildTitle:function(t,e){for(var i=t.pattern.replace(/\\"/g,"%0022"),a=i.match(/\w+:([^\s:\/"]+|"[^"]+")/g),n=[],s=0;s<a.length;++s){var r=a[s],o=r.match(/(\w+):([^\s:\/"]+|"[^"]+")/),l=o[2].replace(/^\s*\(\s*|\s*\)\s*$/g,"");o[1].match(e)||n.push(this.lookupMap[l]||l)}return n.join("/")+" <i>("+t.count+")</i>"},auxHandler:function(t){var e=this;return function(n){if(n.stopPropagation(),e.rangeRemove(),t==e.lastPivotValue)return!1;var s=e.pivotMap[t],r=e.lastPivotMap=e.buildPivotMap(e.getPivotCounts()),o=r[t];e.lastPivotValue=t,e.slidersTarget.empty().parent().addClass("active");for(var l=0,d=s.length;l<d;++l){var u,c=s[l],h=o[l],p={},g=a.ui.fillTemplate("#slider-one");e.slidersTarget.append(g),p.id=c.id,p.targetValue=t,p.color=c.color,p.field=e.field,p.limits=[c.min,c.max],p.initial=[h.min,h.max],p.target=g,p.isRange=!0,p.valuePattern=c.pattern+"{{v}}",p.automatic=!0,p.width=parseInt(e.slidersTarget.width()-i("#sliders-controls").width()-20)/(Math.min(d,2)+.1),p.title=e.buildTitle(h,/^unit[_shd]*|^effectendpoint[_shd]*/),p.units="unit"==h.id?a.ui.formatUnits(h.val):"",p.useJson=e.useJson,p.domain=e.domain,p.sliderRoot=e,e.rangeWidgets.push(u=new SingleRangeWidget(p)),u.init(e.manager)}return!1}},clearValues:function(){this.rangeRemove(),e.pass(this,a.RangeWidgeting,"clearValues")}}}(Solr,asSys,jQuery,jToxKit),function(t,e,i,a){var n='<a href="{{href}}" title="{{hint}}" target="{{target}}" class="{{css}}">{{value}}</a>';a.ItemListWidget=function(t){e.extend(!0,this,e.common(t,this)),this.lookupMap=t.lookupMap||{},this.target=t.target,this.id=t.id},a.ItemListWidget.prototype={baseUrl:"",summaryPrimes:["RESULTS"],onCreated:null,onClick:null,summaryRenderers:{RESULTS:function(t,e){var i=this;return t.map(function(t){return t.split(".").map(function(t){return i.lookupMap[t]||t}).join(".")})},REFOWNERS:function(t,e){return{topic:"Study Providers",content:t.map(function(t){return a.ui.formatString(n,{href:"#",hint:"Freetext search",target:"_self",value:t,css:"freetext_selector"})})}},REFS:function(t,e){return{topic:"References",content:t.map(function(t){return a.ui.formatString(n,{href:t,hint:"External reference",target:"ref",value:t,css:"freetext_selector"})})}}},renderItem:function(t){var e=this,a=i(this.renderSubstance(t));return a.length?(i(this.target).append(a),"function"==typeof this.onClick&&i("a.command",a[0]).on("click",function(i){e.onClick.call(a[0],i,t,e)}),"function"==typeof this.onCreated&&this.onCreated.call(a,t,this),i("a.more",a[0]).on("click",function(t){t.preventDefault(),t.stopPropagation();var e=i(this),a=i(".more-less",e.parent()[0]);return a.is(":visible")?(a.hide(),e.text("more")):(a.show(),e.text("less")),!1}),null):null},renderSubstance:function(t){var e=i("#summary-item").html(),n=this.buildSummary(t),s=function(t){return t.map(function(t){return a.ui.formatString(e,t)}).join("")},r={logo:"images/logo.png",link:"#",href:"#",title:(t.publicname||t.name)+(t.pubname===t.name?"":"  ("+t.name+")")+(null==t.substanceType?"":" "+(this.lookupMap[t.substanceType]||t.substanceType)),composition:this.renderComposition(t,'<a href="'+this.baseUrl+t.s_uuid+'/structure" title="Composition" target="'+t.s_uuid+'">&hellip;</a>').join("<br/>"),summary:n.length>0?s(n.splice(0,this.summaryPrimes.length)):"",item_id:(this.prefix||this.id||"item")+"_"+t.s_uuid,footer:'<a href="'+this.baseUrl+t.s_uuid+'" title="Substance" target="'+t.s_uuid+'">Material</a><a href="'+this.baseUrl+t.s_uuid+'/structure" title="Composition" target="'+t.s_uuid+'">Composition</a><a href="'+this.baseUrl+t.s_uuid+'/study" title="Study" target="'+t.s_uuid+'">Studies</a>'};if(n.length>0&&(r.summary+='<a href="#" class="more">more</a><div class="more-less" style="display:none;">'+s(n)+"</div>"),null==t.content)r.link=this.baseUrl+t.s_uuid,r.href=r.link+"/study",r.href_title="Study",r.href_target=t.s_uuid;else{var o="External database";if(t.owner_name&&0===t.owner_name.lastIndexOf("caNano",0)?(r.logo="images/canano.jpg",r.href_title="caNanoLab: "+r.link,r.href_target=o="caNanoLab",r.footer=""):(r.logo="images/external.png",r.href_title="External: "+r.link,r.href_target="external"),t.content.length>0){r.link=t.content[0];for(var l=0,d=t.content.length;l<d;l++)r.footer+='<a href="'+t.content[l]+'" target="external">'+o+"</a>"}}return a.ui.fillTemplate("#result-item",r)},renderComposition:function(t,i){var s=[],r=t._extended_&&t._extended_.composition;if(r){var o={};e.each(r,function(t){var i=o[t.component_s],s=[];void 0===i&&(o[t.component_s]=i=[]),e.each(t,function(t,e){e=e.match(/([^_]+)_?\a?/)[1],"type"!=e&&"id"!=e&&"component_s"!=e&&s.push(e+":"+a.ui.formatString(n,{href:"#",hint:"Freetext search",target:"_self",value:t,css:"freetext_selector"}))}),i.push(s.join(", "))}),e.each(o,function(t,e){for(var a="",n=0;n<t.length;++n)""!=t[n]&&(a+=0==n?": ":"; ",t.length>1&&(a+="<strong>["+(n+1)+"]</strong>&nbsp;"),a+=t[n]);""===a&&(a=":&nbsp;"+i),a=e+" ("+t.length+")"+a,s.push(a)})}return s},buildSummary:function(t){var i=this,a=[];return e.each(t,function(t,e){var n=e.match(/^SUMMARY\.([^_]+)_?[hsd]*$/);if(n){n=n[1];var s=i.summaryRenderers[n]||i.summaryRenderers._,r="function"==typeof s?s.call(i,t,n):t;if(r){"object"!=typeof r||Array.isArray(r)?r={topic:n.toLowerCase(),values:r}:null==r.topic&&(r.topic=n.toLowerCase()),r.content||(r.content=Array.isArray(r.values)?r.values.join(", "):r.values.toString());var o=i.summaryPrimes.indexOf(n);o>-1&&o<a.length?a.splice(o,0,r):a.push(r)}}}),a}},a.ResultWidgeting=function(t){e.extend(!0,this,e.common(t,this))},a.ResultWidgeting.prototype={__expects:["populate"],init:function(t){e.pass(this,a.ResultWidgeting,"init",t),this.manager=t},beforeRequest:function(){i(this.target).html(i("<img>").attr("src","images/ajax-loader.gif"))},afterTranslation:function(t){i(this.target).empty(),this.populate(t.entries)}},a.ResultWidget=e(t.Listing,a.ListWidget,a.ItemListWidget,a.ResultWidgeting)}(Solr,asSys,jQuery,jToxKit),jToxKit.ui.templates["faceted-search-kit"]='<div class="query-container"><!-- left --><div id="query" class="query-left"><div id="accordion-resizer" class="ui-widget-content"><div id="accordion"></div></div></div><!-- right --><div id="result-tabs" class="query-right"><ul><li><a href="#hits_tab">Hits list</a></li><li><a href="#basket_tab">Selection</a></li><li class="jtox-ds-export"><a href="#export_tab">Export</a></li></ul><div id="hits_tab"><div class="row remove-bottom"><ul class="tags remove-bottom" id="selection"></ul><footer><div id="sliders-controls"><a href="#" class="jtox-fadable command close">Close</a></div><div id="sliders"></div></footer></div><div id="navigation"><ul id="pager"></ul><div id="pager-header"></div></div><div class="docs_wrapper"><section id="docs" class="item-list"></section></div></div><div id="basket_tab"><section id="basket-docs" class="item-list"></section><div style="padding-top: 70px;"></div></div><div id="export_tab"><form target="_blank" method="post"><input type="hidden" name="q"/><h6>Select output format</h6><input type="hidden" name="export_type" id="export_type"/><div class="data_types"></div><h6>Select dataset to export</h6><div id="export_dataset"><input type="radio" value="filtered" name="export_dataset" id="filtered_data" checked="checked"/><label for="filtered_data">Filtered entries</label><input type="radio" value="selected" name="export_dataset" id="selected_data"/><label for="selected_data">Selected entries</label></div><h6>Click to download</h6><button type="submit" name="export_go" data-prefix="Download">?</button><h6><div style="float: left; text-align: center"><a id="whole_dataset" href="https://zenodo.org/record/173258" target="_blank">Full dataset download</a><br><span style="color: black; font-style: italic">hosted on <a href="https://zenodo.org/about" target="_blank"><img src="images/zenodo-black.svg" width="50px" style="padding-bottom: 7px" alt="Zenodo logo"></a></span></div></h6></form></div></div><!-- query container --></div>',jToxKit.ui.templates["faceted-search-templates"]='<section id="result-item"><article id="{{item_id}}" class="item"><header>{{title}}<a href="{{href}}" title="{{href_title}}" target="{{href_target}}"><span class="ui-icon ui-icon-extlink" style="float:right;margin:0;"></span></a></header><a href="{{link}}" title="{{link}}" class="avatar" target="_blank"><img jt-src="{{logo}}"/></a><div class="composition">{{composition}}</div>{{summary}}<footer class="links">{{footer}}<a href="#" class="add jtox-fadable command">Add to Selection</a><a href="#" class="remove jtox-fadable command">Remove from Selection</a><a href="#" class="none jtox-fadable command">Already added</a></footer></article></section><div id="summary-item"><div class="one-summary"><span class="topic">{{topic}}:</span><span class="value">{{content}}</span></div></div><div id="tag-facet"><ul class="tags tag-group folded"></ul></div><div id="tab-topcategory"><h3 id="{{id}}_header" class="nested-tab">{{title}}</h3><div id="{{id}}" class="widget-content widget-root"><input type="text" placeholder="Filter_" class="widget-filter"/><ul class="widget-content tags remove-bottom" data-color="{{color}}"></ul></div></div><div id="slider-one"><input type="hidden"/></div><div id="export-type"><div class="jtox-inline jtox-ds-download jtox-fadable"><a target="_blank" data-mime="{{mime}}" href="#"><img class="borderless" jt-src="{{icon}}"/></a></div></div>';
